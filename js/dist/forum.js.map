{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@nearata/flarum-ext-cakeday/webpack/bootstrap","webpack://@nearata/flarum-ext-cakeday/webpack/runtime/compat get default export","webpack://@nearata/flarum-ext-cakeday/webpack/runtime/define property getters","webpack://@nearata/flarum-ext-cakeday/webpack/runtime/hasOwnProperty shorthand","webpack://@nearata/flarum-ext-cakeday/webpack/runtime/make namespace object","webpack://@nearata/flarum-ext-cakeday/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@nearata/flarum-ext-cakeday/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@nearata/flarum-ext-cakeday/./src/forum/states/AnniversariesState.js","webpack://@nearata/flarum-ext-cakeday/external root \"flarum.core.compat['common/Component']\"","webpack://@nearata/flarum-ext-cakeday/external root \"flarum.core.compat['common/helpers/avatar']\"","webpack://@nearata/flarum-ext-cakeday/./src/forum/components/AnniversariesListItem.js","webpack://@nearata/flarum-ext-cakeday/external root \"flarum.core.compat['common/components/Button']\"","webpack://@nearata/flarum-ext-cakeday/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@nearata/flarum-ext-cakeday/external root \"flarum.core.compat['common/components/Placeholder']\"","webpack://@nearata/flarum-ext-cakeday/./src/forum/components/AnniversariesList.js","webpack://@nearata/flarum-ext-cakeday/external root \"flarum.core.compat['common/components/Dropdown']\"","webpack://@nearata/flarum-ext-cakeday/external root \"flarum.core.compat['common/components/IndexPage']\"","webpack://@nearata/flarum-ext-cakeday/external root \"flarum.core.compat['common/helpers/listItems']\"","webpack://@nearata/flarum-ext-cakeday/external root \"flarum.core.compat['common/utils/ItemList']\"","webpack://@nearata/flarum-ext-cakeday/external root \"flarum.core.compat['forum/components/Page']\"","webpack://@nearata/flarum-ext-cakeday/./src/forum/components/AnniversariesPage.js","webpack://@nearata/flarum-ext-cakeday/external root \"flarum.core.compat['common/components/Badge']\"","webpack://@nearata/flarum-ext-cakeday/external root \"flarum.core.compat['common/components/LinkButton']\"","webpack://@nearata/flarum-ext-cakeday/external root \"flarum.core.compat['common/extend']\"","webpack://@nearata/flarum-ext-cakeday/external root \"flarum.core.compat['common/models/User']\"","webpack://@nearata/flarum-ext-cakeday/external root \"flarum.core.compat['forum/app']\"","webpack://@nearata/flarum-ext-cakeday/./src/forum/index.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","const trans = (key) => {\n    return app.translator.trans(\n        `nearata-cakeday.forum.page.filter_options.${key}`\n    );\n};\n\nconst text1 = (dayjs) => {\n    const date = dayjs.format(\"ll\");\n\n    return app.translator.trans(\n        \"nearata-cakeday.forum.page.anniversaries_for_label\",\n        { date }\n    );\n};\n\nconst text2 = (dayjs1, dayjs2) => {\n    const date1 = dayjs1.format(\"ll\");\n    const date2 = dayjs2.format(\"ll\");\n\n    return app.translator.trans(\n        \"nearata-cakeday.forum.page.anniversaries_between_label\",\n        { date1, date2 }\n    );\n};\n\n/**\n * Based on FriendsOfFlarum's UserDirectoryState\n */\n\nexport default class AnniversariesState {\n    constructor() {\n        this.users = [];\n        this.loading = false;\n        this.moreResults = false;\n        this.currentFilter = \"today\";\n    }\n\n    loadUsers() {\n        app.store.find(\"users\", this.getParams()).then(\n            (users) => {\n                this.users.push(...users);\n                this.moreResults =\n                    !!users.payload.links && !!users.payload.links.next;\n                this.loading = false;\n                m.redraw();\n            },\n            () => {\n                this.loading = false;\n                m.redraw();\n            }\n        );\n    }\n\n    refreshUsers() {\n        this.loading = true;\n\n        this.clearUsers();\n        this.loadUsers();\n    }\n\n    hasMoreResults() {\n        return this.moreResults;\n    }\n\n    clearUsers() {\n        this.users = [];\n        m.redraw();\n    }\n\n    isLoading() {\n        return this.loading;\n    }\n\n    loadMore() {\n        this.loading = true;\n        this.loadUsers();\n    }\n\n    getParams() {\n        const params = {};\n\n        params[\"page\"] = { offset: this.users.length };\n        params[\"sort\"] = \"joinedAt\";\n        params[\"filter\"] = { cakeday: this.currentFilter };\n\n        return params;\n    }\n\n    getFilterOptions() {\n        return {\n            today: trans(\"today\"),\n            tomorrow: trans(\"tomorrow\"),\n            upcoming: trans(\"upcoming\"),\n            all: trans(\"all\"),\n        };\n    }\n\n    getCurrentFilter() {\n        return this.currentFilter;\n    }\n\n    changeFilter(option) {\n        this.currentFilter = option;\n        this.refreshUsers();\n    }\n\n    isEmpty() {\n        return this.users.length === 0 && !this.isLoading();\n    }\n\n    getH2() {\n        const today = window.dayjs();\n        const tomorrow = today.add(1, \"day\");\n        const upcoming = tomorrow.add(1, \"day\");\n\n        let text = \"\";\n        switch (this.currentFilter) {\n            case \"today\":\n                text = text1(today);\n                break;\n            case \"tomorrow\":\n                text = text1(tomorrow);\n                break;\n            case \"upcoming\":\n                const upcomingTo = upcoming.add(1, \"week\");\n                text = text2(upcoming, upcomingTo);\n                break;\n            case \"all\":\n                const start = today.startOf(\"year\");\n                const end = today.endOf(\"year\");\n                text = text2(start, end);\n                break;\n            default:\n                break;\n        }\n\n        return text;\n    }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Component'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/avatar'];","import Component from \"flarum/common/Component\";\nimport avatar from \"flarum/common/helpers/avatar\";\n\n/**\n * Based on FriendsOfFlarum's UserDirectoryListItem\n */\n\nexport default class UserDirectoryListItem extends Component {\n    view() {\n        const user = this.attrs.user;\n        const todayYear = window.dayjs().year();\n\n        const getFormattedDate = (date) => {\n            return window.dayjs(date).year(todayYear).format(\"YYYY-MM-DD\");\n        };\n\n        return [\n            m(\".user\", [\n                m(\".avatar\", avatar(user, { title: \"\" })),\n                m(\"\", [\n                    m(\".username\", user.username()),\n                    m(\n                        \".joinTime\",\n                        getFormattedDate(user.attribute(\"joinTime\"))\n                    ),\n                ]),\n            ]),\n        ];\n    }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LoadingIndicator'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Placeholder'];","import AnniversariesListItem from \"./AnniversariesListItem\";\nimport Component from \"flarum/common/Component\";\nimport Button from \"flarum/common/components/Button\";\nimport LoadingIndicator from \"flarum/common/components/LoadingIndicator\";\nimport Placeholder from \"flarum/common/components/Placeholder\";\n\n/**\n * Based on FriendsOfFlarum's UserDirectoryList\n */\n\nexport default class AnniversariesList extends Component {\n    view() {\n        const state = this.attrs.state;\n\n        let loading;\n\n        if (state.isLoading()) {\n            loading = m(LoadingIndicator);\n        } else if (state.hasMoreResults()) {\n            loading = m(\n                Button,\n                {\n                    class: \"Button\",\n                    onclick: state.loadMore.bind(state),\n                },\n                app.translator.trans(\n                    \"nearata-cakeday.forum.page.load_more_button\"\n                )\n            );\n        }\n\n        if (state.isEmpty()) {\n            const text = app.translator.trans(\n                \"nearata-cakeday.forum.page.empty\"\n            );\n            return [\n                m(\".AnniversariesList\", [\n                    m(\"h2\", state.getH2()),\n                    m(Placeholder, { text: text }),\n                ]),\n            ];\n        }\n\n        return [\n            m(\".AnniversariesList\", [\n                m(\"h2\", state.getH2()),\n                m(\"ul.AnniversariesList-users\", [\n                    state.users.map((user) => {\n                        return [\n                            m(\n                                \"li\",\n                                {\n                                    \"data-id\": user.id(),\n                                },\n                                m(AnniversariesListItem, { user: user })\n                            ),\n                        ];\n                    }),\n                ]),\n                m(\".AnniversariesList-loadMore\", loading),\n            ]),\n        ];\n    }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Dropdown'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/IndexPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/listItems'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/ItemList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/Page'];","import AnniversariesState from \"../states/AnniversariesState\";\nimport AnniversariesList from \"./AnniversariesList\";\nimport Button from \"flarum/common/components/Button\";\nimport Dropdown from \"flarum/common/components/Dropdown\";\nimport IndexPage from \"flarum/common/components/IndexPage\";\nimport listItems from \"flarum/common/helpers/listItems\";\nimport ItemList from \"flarum/common/utils/ItemList\";\nimport Page from \"flarum/forum/components/Page\";\n\n/**\n * Based on FriendsOfFlarum's UserDirectoryPage\n */\n\nexport default class AnniversariesPage extends Page {\n    oninit(vnode) {\n        super.oninit(vnode);\n\n        this.state = new AnniversariesState();\n        this.state.refreshUsers();\n\n        this.filterOptions = this.state.getFilterOptions();\n        this.currentFilter = this.state.getCurrentFilter();\n    }\n\n    view() {\n        return [\n            m(\".IndexPage\", [\n                IndexPage.prototype.hero(),\n                m(\".container\", [\n                    m(\".sideNavContainer\", [\n                        m(\"nav.IndexPage-nav.sideNav\", [\n                            m(\"ul\", listItems(this.sidebarItems().toArray())),\n                        ]),\n                        m(\".IndexPage-results.sideNavOffset\", [\n                            m(\".IndexPage-toolbar\", [\n                                m(\n                                    \"ul.IndexPage-toolbar-view\",\n                                    listItems(this.viewItems().toArray())\n                                ),\n                                m(\n                                    \"ul.IndexPage-toolbar-action\",\n                                    listItems(this.actionItems().toArray())\n                                ),\n                            ]),\n                            m(AnniversariesList, { state: this.state }),\n                        ]),\n                    ]),\n                ]),\n            ]),\n        ];\n    }\n\n    sidebarItems() {\n        return IndexPage.prototype.sidebarItems();\n    }\n\n    viewItems() {\n        const items = new ItemList();\n\n        items.add(\n            \"sort\",\n            m(\n                Dropdown,\n                {\n                    buttonClassName: \"Button\",\n                    label: this.filterOptions[this.currentFilter],\n                },\n                Object.keys(this.filterOptions).map((value) => {\n                    const label = this.filterOptions[value];\n                    const active = this.currentFilter === value;\n\n                    return m(\n                        Button,\n                        {\n                            icon: active ? \"fas fa-check\" : true,\n                            active: active,\n                            onclick: () => {\n                                this.changeFilter(value);\n                            },\n                        },\n                        label\n                    );\n                })\n            )\n        );\n\n        return items;\n    }\n\n    actionItems() {\n        const items = new ItemList();\n\n        items.add(\n            \"refresh\",\n            m(Button, {\n                title: app.translator.trans(\"core.forum.index.refresh_tooltip\"),\n                icon: \"fas fa-sync\",\n                class: \"Button Button--icon\",\n                onclick: () => {\n                    this.state.refreshUsers();\n                },\n            })\n        );\n\n        return items;\n    }\n\n    changeFilter(option) {\n        this.state.changeFilter(option);\n        this.currentFilter = this.state.getCurrentFilter();\n    }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Badge'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LinkButton'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/models/User'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","import AnniversariesPage from \"./components/AnniversariesPage\";\nimport Badge from \"flarum/common/components/Badge\";\nimport IndexPage from \"flarum/common/components/IndexPage\";\nimport LinkButton from \"flarum/common/components/LinkButton\";\nimport { extend } from \"flarum/common/extend\";\nimport User from \"flarum/common/models/User\";\nimport app from \"flarum/forum/app\";\n\nconst memberDay = (today, joinTime) => {\n    const days = app.forum.attribute(\"cakedayNewMembersDays\");\n    const endDate = window.dayjs(joinTime).add(days, \"day\");\n\n    return today < endDate;\n};\n\napp.initializers.add(\"nearata-cakeday\", () => {\n    app.routes.nearata_cakeday_anniversaries = {\n        path: \"/anniversaries\",\n        resolver: {\n            onmatch: function (args) {\n                if (!app.forum.attribute(\"cakedayPageEnabled\")) {\n                    return m.route.SKIP;\n                }\n\n                if (!app.session.user) {\n                    return m.route.SKIP;\n                }\n\n                if (!app.session.user.attribute(\"canNearataCakedayViewPage\")) {\n                    return m.route.SKIP;\n                }\n\n                return AnniversariesPage;\n            },\n        },\n    };\n\n    extend(IndexPage.prototype, \"navItems\", (items) => {\n        if (!app.forum.attribute(\"cakedayPageEnabled\")) {\n            return;\n        }\n\n        if (!app.session.user) {\n            return;\n        }\n\n        if (!app.session.user.attribute(\"canNearataCakedayViewPage\")) {\n            return;\n        }\n\n        items.add(\n            \"nearataCakedayAnniversaries\",\n            m(\n                LinkButton,\n                {\n                    href: app.route(\"nearata_cakeday_anniversaries\"),\n                    icon: \"fas fa-birthday-cake\",\n                },\n                app.translator.trans(\"nearata-cakeday.forum.page.title\")\n            )\n        );\n    });\n\n    extend(User.prototype, \"badges\", function (items) {\n        const joinTime = this.joinTime();\n\n        const join = window.dayjs(joinTime);\n        const today = window.dayjs();\n\n        let label = app.translator.trans(\"nearata-cakeday.forum.anniversary\");\n\n        const isMemberDay = app.forum.attribute(\"cakedayNewMembers\");\n        const isSameYear =\n            today.year() === join.year() && memberDay(today, joinTime);\n\n        if (isMemberDay && (isSameYear || memberDay(today, join))) {\n            if (app.forum.attribute(\"cakedayNewMembersLabel\")) {\n                label = app.translator.trans(\n                    \"nearata-cakeday.forum.new_member_label\"\n                );\n            }\n        } else {\n            const isMonth = join.month() === today.month();\n            const isDay = join.date() === today.date();\n\n            if (!(isMonth && isDay)) {\n                return;\n            }\n        }\n\n        const bgColor = app.forum.attribute(\"cakedayBgColor\");\n        const textColor = app.forum.attribute(\"cakedayTextColor\");\n\n        items.add(\n            \"nearataCakeday\",\n            m(Badge, {\n                type: \"cakeday\",\n                icon: \"fas fa-birthday-cake\",\n                label: label,\n                style: `background-color:${bgColor};color:${textColor}`,\n            })\n        );\n    });\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","_inheritsLoose","subClass","superClass","create","constructor","trans","app","translator","text1","dayjs","date","format","text2","dayjs1","dayjs2","date1","date2","AnniversariesState","this","users","loading","moreResults","currentFilter","loadUsers","store","find","getParams","then","push","payload","links","next","m","redraw","refreshUsers","clearUsers","hasMoreResults","isLoading","loadMore","params","offset","length","cakeday","getFilterOptions","today","tomorrow","upcoming","all","getCurrentFilter","changeFilter","option","isEmpty","getH2","window","add","text","upcomingTo","start","startOf","end","endOf","flarum","core","compat","UserDirectoryListItem","view","user","attrs","todayYear","year","avatar","title","username","attribute","Component","AnniversariesList","state","LoadingIndicator","Button","class","onclick","Placeholder","map","id","AnniversariesListItem","AnniversariesPage","oninit","vnode","filterOptions","IndexPage","listItems","sidebarItems","toArray","viewItems","actionItems","items","ItemList","Dropdown","buttonClassName","label","keys","active","icon","Page","memberDay","joinTime","days","path","resolver","onmatch","args","route","SKIP","extend","LinkButton","href","User","join","isMemberDay","isSameYear","isMonth","month","isDay","bgColor","textColor","Badge","type","style"],"sourceRoot":""}