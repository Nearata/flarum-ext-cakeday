{"version":3,"file":"forum.js","mappings":"MACA,IAAIA,EAAsB,CCA1BA,EAAyBC,IACxB,IAAIC,EAASD,GAAUA,EAAOE,WAC7B,IAAOF,EAAiB,QACxB,IAAM,EAEP,OADAD,EAAoBI,EAAEF,EAAQ,CAAEG,EAAGH,IAC5BA,CAAM,ECLdF,EAAwB,CAACM,EAASC,KACjC,IAAI,IAAIC,KAAOD,EACXP,EAAoBS,EAAEF,EAAYC,KAASR,EAAoBS,EAAEH,EAASE,IAC5EE,OAAOC,eAAeL,EAASE,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,IAE1E,ECNDR,EAAwB,CAACc,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,GCClFf,EAAyBM,IACH,oBAAXa,QAA0BA,OAAOC,aAC1CV,OAAOC,eAAeL,EAASa,OAAOC,YAAa,CAAEC,MAAO,WAE7DX,OAAOC,eAAeL,EAAS,aAAc,CAAEe,OAAO,GAAO,G,wBCL/C,SAASC,EAAgBb,EAAGc,GAKzC,OAJAD,EAAkBZ,OAAOc,eAAiBd,OAAOc,eAAeC,OAAS,SAAyBhB,EAAGc,GAEnG,OADAd,EAAEiB,UAAYH,EACPd,CACR,EACMa,EAAgBb,EAAGc,EAC3B,CCLc,SAASI,EAAeC,EAAUC,GAC/CD,EAASZ,UAAYN,OAAOoB,OAAOD,EAAWb,WAC9CY,EAASZ,UAAUe,YAAcH,EACjCJ,EAAeI,EAAUC,EAC1B,C,OCLD,MAAM,EAA+BG,OAAOC,KAAKC,OAAO,a,aCIlDC,EAAQ,SAAC3B,GACb,OAAO4B,IAAAA,WAAeD,MAAf,6CACwC3B,EAEhD,EAEK6B,EAAQ,SAACC,GACb,IAAMC,EAAOD,EAAME,OAAO,MAE1B,OAAOJ,IAAAA,WAAeD,MACpB,qDACA,CAAEI,KAAAA,GAEL,EAEKE,EAAQ,SAACC,EAAaC,GAC1B,IAAMC,EAAQF,EAAOF,OAAO,MACtBK,EAAQF,EAAOH,OAAO,MAE5B,OAAOJ,IAAAA,WAAeD,MACpB,yDACA,CAAES,MAAAA,EAAOC,MAAAA,GAEZ,EAMoBC,EAAAA,WAMnB,aAAc,KALdC,WAKc,OAJdC,aAIc,OAHdC,iBAGc,OAFdC,mBAEc,EACZC,KAAKJ,MAAQ,GACbI,KAAKH,SAAU,EACfG,KAAKF,aAAc,EACnBE,KAAKD,cAAgB,OACtB,C,2BAEDE,UAAA,WAAY,WACVhB,IAAAA,MAAUiB,KAAK,QAASF,KAAKG,aAAaC,MACxC,SAACR,GAAe,OACd,IAAKA,OAAMS,KAAX,QAAmBT,GAEnB,EAAKE,cAAgBF,EAAMU,QAAQC,SAAWX,EAAMU,QAAQC,MAAMC,KAElE,EAAKX,SAAU,EAEfY,EAAEC,QACH,IACD,WACE,EAAKb,SAAU,EAEfY,EAAEC,QACH,GAEJ,E,EAEDC,aAAA,WACEX,KAAKH,SAAU,EAEfG,KAAKY,aACLZ,KAAKC,WACN,E,EAEDY,eAAA,WACE,OAAOb,KAAKF,WACb,E,EAEDc,WAAA,WACEZ,KAAKJ,MAAQ,GAEba,EAAEC,QACH,E,EAEDI,UAAA,WACE,OAAOd,KAAKH,OACb,E,EAEDkB,SAAA,WACEf,KAAKH,SAAU,EACfG,KAAKC,WACN,E,EAEDE,UAAA,WACE,IAAMa,EAAiC,CAAC,EAMxC,OAJAA,EAAM,KAAW,CAAEC,OAAQjB,KAAKJ,MAAMsB,QACtCF,EAAM,KAAW,WACjBA,EAAM,OAAa,CAAEG,QAASnB,KAAKD,eAE5BiB,CACR,E,EAEDI,iBAAA,WACE,MAAO,CACLC,MAAOrC,EAAM,SACbsC,SAAUtC,EAAM,YAChBuC,SAAUvC,EAAM,YAChBwC,IAAKxC,EAAM,OAEd,E,EAEDyC,iBAAA,WACE,OAAOzB,KAAKD,aACb,E,EAED2B,aAAA,SAAaC,GACX3B,KAAKD,cAAgB4B,EACrB3B,KAAKW,cACN,E,EAEDiB,QAAA,WACE,OAA6B,IAAtB5B,KAAKJ,MAAMsB,SAAiBlB,KAAKc,WACzC,E,EAEDe,MAAA,WACE,IAAMR,EAAQS,OAAO3C,QACfmC,EAAWD,EAAMU,IAAI,EAAG,OACxBR,EAAWD,EAASS,IAAI,EAAG,OAE7BC,EAAmC,GAEvC,OAAQhC,KAAKD,eACX,IAAK,QACHiC,EAAO9C,EAAMmC,GACb,MACF,IAAK,WACHW,EAAO9C,EAAMoC,GACb,MACF,IAAK,WACH,IAAMW,EAAaV,EAASQ,IAAI,EAAG,QACnCC,EAAO1C,EAAMiC,EAAUU,GACvB,MACF,IAAK,MACH,IAAMC,EAAQb,EAAMc,QAAQ,QACtBC,EAAMf,EAAMgB,MAAM,QACxBL,EAAO1C,EAAM4C,EAAOE,GAMxB,OAAOJ,CACR,E,EAtHkBrC,GCjCrB,MAAM,EAA+Bd,OAAOC,KAAKC,OAAO,oB,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,yB,aCYnCuD,EAAAA,SAAAA,G,wIACnBC,UAAAA,E,4BAEAC,KAAA,WACE,IAG0BpD,EAHpBmD,EAAOvC,KAAKyC,MAAMF,KAClBG,EAAYZ,OAAO3C,QAAQwD,OAMjC,MAAO,CACLlC,EAAE,QAAS,CACTA,EAAE,UAAWmC,IAAOL,EAAM,CAAEM,MAAO,MACnCpC,EAAE,GAAI,CACJA,EAAE,YAAa8B,EAAKO,YACpBrC,EAAE,aATkBrB,EASYmD,EAAKQ,UAAU,YAR5CjB,OAAO3C,MAAMC,GAAMuD,KAAKD,GAAWrD,OAAO,oBAYpD,E,EApBkBiD,CAA8BU,KCZnD,MAAM,EAA+BnE,OAAOC,KAAKC,OAAO,4B,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,sC,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,iC,aCgBnCkE,EAAAA,SAAAA,G,4EACnBT,KAAA,WACE,IAEI3C,EAFEqD,EAAQlD,KAAKyC,MAAMS,MAiBzB,GAbIA,EAAMrD,QACRA,EAAUY,EAAE0C,KACHD,EAAMrC,mBACfhB,EAAUY,EACR2C,IACA,CACEC,MAAO,SACPC,QAASJ,EAAMnC,SAASzC,KAAK4E,IAE/BjE,IAAAA,WAAeD,MAAM,iDAIrBkE,EAAMtB,UAAW,CACnB,IAAMI,EAAO/C,IAAAA,WAAeD,MAAM,oCAClC,MAAO,CACLyB,EAAE,qBAAsB,CACtBA,EAAE,KAAMyC,EAAMrB,SACdpB,EAAE8C,IAAa,CAAEvB,KAAMA,MAG5B,CAED,MAAO,CACLvB,EAAE,qBAAsB,CACtBA,EAAE,KAAMyC,EAAMrB,SACdpB,EAAE,6BAA8B,CAC9ByC,EAAMtD,MAAM4D,KAAI,SAACjB,GACf,MAAO,CACL9B,EACE,KACA,CACE,UAAW8B,EAAKkB,MAElBhD,EAAEiD,EAAuB,CAAEnB,KAAMA,KAGtC,MAEH9B,EAAE,8BAA+BZ,KAGtC,E,EAhDkBoD,CAA0BD,KChB/C,MAAM,EAA+BnE,OAAOC,KAAKC,OAAO,8B,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,0B,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,4B,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,yB,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,8B,aCcnC4E,EAAAA,SAAAA,G,wIACnBC,wBAAAA,E,EACAC,mBAAAA,E,EACA9D,mBAAAA,E,oCAEA+D,OAAA,SAAOC,GACL,YAAMD,OAAN,UAAaC,GAEb/D,KAAK4D,mBAAqB,IAAIjE,EAC9BK,KAAK4D,mBAAmBjD,eAExBX,KAAK6D,cAAgB7D,KAAK4D,mBAAmBxC,mBAC7CpB,KAAKD,cAAgBC,KAAK4D,mBAAmBnC,kBAC9C,E,EAEDuC,SAAA,SAASD,GACP,YAAMC,SAAN,UAAeD,GAGf9E,IAAAA,SAAaA,IAAAA,WAAeD,MAAM,qCAClCC,IAAAA,cAAkB,EACnB,E,EAEDuD,KAAA,WACE,MAAO,CACL/B,EAAE,aAAc,CACdwD,IAAAA,UAAoBC,OACpBzD,EAAE,aAAc,CACdA,EAAE,oBAAqB,CACrBA,EAAE,4BAA6B,CAC7BA,EAAE,KAAM0D,IAAUnE,KAAKoE,eAAeC,cAExC5D,EAAE,mCAAoC,CACpCA,EAAE,qBAAsB,CACtBA,EACE,4BACA0D,IAAUnE,KAAKsE,YAAYD,YAE7B5D,EACE,8BACA0D,IAAUnE,KAAKuE,cAAcF,cAGjC5D,EAAEwC,EAAmB,CACnBC,MAAOlD,KAAK4D,6BAOzB,E,EAEDQ,aAAA,WACE,OAAOH,IAAAA,UAAoBG,cAC5B,E,EAEDE,UAAA,WAA2B,WACnBE,EAAQ,IAAIC,KA6BlB,OA3BAD,EAAMzC,IACJ,OACAtB,EACEiE,IACA,CACEC,gBAAiB,SACjBC,MAAO5E,KAAK6D,cAAc7D,KAAKD,gBAEjCxC,OAAOsH,KAAK7E,KAAK6D,eAAeL,KAAI,SAACtF,GACnC,IAAM0G,EAAQ,EAAKf,cAAc3F,GAC3B4G,EAAS,EAAK/E,gBAAkB7B,EAEtC,OAAOuC,EACL2C,IACA,CACE2B,MAAMD,GAAS,eACfA,OAAQA,EACRxB,QAAS,WACP,EAAK5B,aAAaxD,EACnB,GAEH0G,EAEH,MAIEJ,CACR,E,EAEDD,YAAA,WAA6B,WACrBC,EAAQ,IAAIC,KAclB,OAZAD,EAAMzC,IACJ,UACAtB,EAAE2C,IAAQ,CACRP,MAAO5D,IAAAA,WAAeD,MAAM,oCAC5B+F,KAAM,cACN1B,MAAO,sBACPC,QAAS,WACP,EAAKM,mBAAmBjD,cACzB,KAIE6D,CACR,E,EAED9C,aAAA,SAAaC,GACX3B,KAAK4D,mBAAmBlC,aAAaC,GACrC3B,KAAKD,cAAgBC,KAAK4D,mBAAmBnC,kBAC9C,E,EA/GkBkC,CAA0BqB,KCd/C,MAAM,EAA+BnG,OAAOC,KAAKC,OAAO,2B,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,gC,aCAxD,MAAM,EAA+BF,OAAOC,KAAKC,OAAO,iBCAlD,EAA+BF,OAAOC,KAAKC,OAAO,sB,aCQlDkG,EAAY,SAAC5D,EAAO6D,GACxB,IAAMC,EAAOlG,IAAAA,MAAU8D,UAAU,yBAGjC,OAAO1B,EAFSS,OAAO3C,MAAM+F,GAAUnD,IAAIoD,EAAM,MAGlD,EAEDlG,IAAAA,aAAiB8C,IAAI,mBAAmB,WACtC9C,IAAAA,OAAWmG,8BAAgC,CACzCC,KAAM,iBACNC,SAAU,CACRC,QAAS,SAAUC,GACjB,OAAKvG,IAAAA,MAAU8D,UAAU,uBAIpB9D,IAAAA,QAAYsD,MAIZtD,IAAAA,QAAYsD,KAAKQ,UAAU,6BAIzBY,EAXElD,EAAEgF,MAAMC,IAYlB,KAILC,EAAAA,EAAAA,QAAO1B,IAAAA,UAAqB,YAAY,SAACO,GAClCvF,IAAAA,MAAU8D,UAAU,uBAIpB9D,IAAAA,QAAYsD,MAIZtD,IAAAA,QAAYsD,KAAKQ,UAAU,8BAIhCyB,EAAMzC,IACJ,8BACAtB,EACEmF,IACA,CACEC,KAAM5G,IAAAA,MAAU,iCAChB8F,KAAM,wBAER9F,IAAAA,WAAeD,MAAM,qCAG1B,KAED2G,EAAAA,EAAAA,QAAOG,IAAAA,UAAgB,UAAU,SAAUtB,GACzC,IAAMU,EAAWlF,KAAKkF,WAEhBa,EAAOjE,OAAO3C,MAAM+F,GACpB7D,EAAQS,OAAO3C,QAEjByF,EAAQ3F,IAAAA,WAAeD,MAAM,qCAE3BgH,EAAc/G,IAAAA,MAAU8D,UAAU,qBAClCkD,EACJ5E,EAAMsB,SAAWoD,EAAKpD,QAAUsC,EAAU5D,EAAO6D,GAEnD,GAAIc,IAAgBC,GAAchB,EAAU5D,EAAO0E,IAC7C9G,IAAAA,MAAU8D,UAAU,4BACtB6B,EAAQ3F,IAAAA,WAAeD,MAAM,+CAE1B,CACL,IAAMkH,EAAUH,EAAKI,UAAY9E,EAAM8E,QACjCC,EAAQL,EAAK3G,SAAWiC,EAAMjC,OAEpC,IAAM8G,IAAWE,EACf,MAEH,CAED,IAAMC,EAAUpH,IAAAA,MAAU8D,UAAU,kBAC9BuD,EAAYrH,IAAAA,MAAU8D,UAAU,oBAEtCyB,EAAMzC,IACJ,iBACAtB,EAAE8F,IAAO,CACPC,KAAM,UACNzB,KAAM,uBACNH,MAAOA,EACP6B,MAAO,oBAAoBJ,EAAtB,UAAuCC,IAGjD,GACF,G","sources":["webpack://@nearata/flarum-ext-cakeday/webpack/bootstrap","webpack://@nearata/flarum-ext-cakeday/webpack/runtime/compat get default export","webpack://@nearata/flarum-ext-cakeday/webpack/runtime/define property getters","webpack://@nearata/flarum-ext-cakeday/webpack/runtime/hasOwnProperty shorthand","webpack://@nearata/flarum-ext-cakeday/webpack/runtime/make namespace object","webpack://@nearata/flarum-ext-cakeday/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@nearata/flarum-ext-cakeday/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@nearata/flarum-ext-cakeday/external root \"flarum.core.compat['forum/app']\"","webpack://@nearata/flarum-ext-cakeday/./src/forum/states/AnniversariesState.ts","webpack://@nearata/flarum-ext-cakeday/external root \"flarum.core.compat['common/Component']\"","webpack://@nearata/flarum-ext-cakeday/external root \"flarum.core.compat['common/helpers/avatar']\"","webpack://@nearata/flarum-ext-cakeday/./src/forum/components/AnniversariesListItem.ts","webpack://@nearata/flarum-ext-cakeday/external root \"flarum.core.compat['common/components/Button']\"","webpack://@nearata/flarum-ext-cakeday/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@nearata/flarum-ext-cakeday/external root \"flarum.core.compat['common/components/Placeholder']\"","webpack://@nearata/flarum-ext-cakeday/./src/forum/components/AnniversariesList.ts","webpack://@nearata/flarum-ext-cakeday/external root \"flarum.core.compat['common/components/Dropdown']\"","webpack://@nearata/flarum-ext-cakeday/external root \"flarum.core.compat['common/components/Page']\"","webpack://@nearata/flarum-ext-cakeday/external root \"flarum.core.compat['common/helpers/listItems']\"","webpack://@nearata/flarum-ext-cakeday/external root \"flarum.core.compat['common/utils/ItemList']\"","webpack://@nearata/flarum-ext-cakeday/external root \"flarum.core.compat['forum/components/IndexPage']\"","webpack://@nearata/flarum-ext-cakeday/./src/forum/components/AnniversariesPage.ts","webpack://@nearata/flarum-ext-cakeday/external root \"flarum.core.compat['common/components/Badge']\"","webpack://@nearata/flarum-ext-cakeday/external root \"flarum.core.compat['common/components/LinkButton']\"","webpack://@nearata/flarum-ext-cakeday/external root \"flarum.core.compat['common/extend']\"","webpack://@nearata/flarum-ext-cakeday/external root \"flarum.core.compat['common/models/User']\"","webpack://@nearata/flarum-ext-cakeday/./src/forum/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","import { NestedStringArray } from \"@askvortsov/rich-icu-message-formatter\";\nimport User from \"flarum/common/models/User\";\nimport app from \"flarum/forum/app\";\n\nconst trans = (key: string) => {\n  return app.translator.trans(\n    `nearata-cakeday.forum.page.filter_options.${key}`\n  );\n};\n\nconst text1 = (dayjs: any) => {\n  const date = dayjs.format(\"ll\");\n\n  return app.translator.trans(\n    \"nearata-cakeday.forum.page.anniversaries_for_label\",\n    { date }\n  );\n};\n\nconst text2 = (dayjs1: any, dayjs2: any) => {\n  const date1 = dayjs1.format(\"ll\");\n  const date2 = dayjs2.format(\"ll\");\n\n  return app.translator.trans(\n    \"nearata-cakeday.forum.page.anniversaries_between_label\",\n    { date1, date2 }\n  );\n};\n\n/**\n * Based on FriendsOfFlarum's UserDirectoryState\n */\n\nexport default class AnniversariesState {\n  users: Array<User>;\n  loading: boolean;\n  moreResults: boolean;\n  currentFilter: string;\n\n  constructor() {\n    this.users = [];\n    this.loading = false;\n    this.moreResults = false;\n    this.currentFilter = \"today\";\n  }\n\n  loadUsers() {\n    app.store.find(\"users\", this.getParams()).then(\n      (users: any) => {\n        this.users.push(...users);\n\n        this.moreResults = !!users.payload.links && !!users.payload.links.next;\n\n        this.loading = false;\n\n        m.redraw();\n      },\n      () => {\n        this.loading = false;\n\n        m.redraw();\n      }\n    );\n  }\n\n  refreshUsers() {\n    this.loading = true;\n\n    this.clearUsers();\n    this.loadUsers();\n  }\n\n  hasMoreResults(): boolean {\n    return this.moreResults;\n  }\n\n  clearUsers() {\n    this.users = [];\n\n    m.redraw();\n  }\n\n  isLoading(): boolean {\n    return this.loading;\n  }\n\n  loadMore() {\n    this.loading = true;\n    this.loadUsers();\n  }\n\n  getParams(): any {\n    const params: { [key: string]: any } = {};\n\n    params[\"page\"] = { offset: this.users.length };\n    params[\"sort\"] = \"joinedAt\";\n    params[\"filter\"] = { cakeday: this.currentFilter };\n\n    return params;\n  }\n\n  getFilterOptions(): { [key: string]: any } {\n    return {\n      today: trans(\"today\"),\n      tomorrow: trans(\"tomorrow\"),\n      upcoming: trans(\"upcoming\"),\n      all: trans(\"all\"),\n    };\n  }\n\n  getCurrentFilter(): string {\n    return this.currentFilter;\n  }\n\n  changeFilter(option: string) {\n    this.currentFilter = option;\n    this.refreshUsers();\n  }\n\n  isEmpty(): boolean {\n    return this.users.length === 0 && !this.isLoading();\n  }\n\n  getH2(): NestedStringArray {\n    const today = window.dayjs();\n    const tomorrow = today.add(1, \"day\");\n    const upcoming = tomorrow.add(1, \"day\");\n\n    let text: string | NestedStringArray = \"\";\n\n    switch (this.currentFilter) {\n      case \"today\":\n        text = text1(today);\n        break;\n      case \"tomorrow\":\n        text = text1(tomorrow);\n        break;\n      case \"upcoming\":\n        const upcomingTo = upcoming.add(1, \"week\");\n        text = text2(upcoming, upcomingTo);\n        break;\n      case \"all\":\n        const start = today.startOf(\"year\");\n        const end = today.endOf(\"year\");\n        text = text2(start, end);\n        break;\n      default:\n        break;\n    }\n\n    return text;\n  }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Component'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/avatar'];","import Component, { ComponentAttrs } from \"flarum/common/Component\";\nimport avatar from \"flarum/common/helpers/avatar\";\nimport User from \"flarum/common/models/User\";\n\ninterface Attrs extends ComponentAttrs {\n  user: User;\n}\n\n/**\n * Based on FriendsOfFlarum's UserDirectoryListItem\n */\n\nexport default class UserDirectoryListItem extends Component<Attrs> {\n  user!: User;\n\n  view() {\n    const user = this.attrs.user;\n    const todayYear = window.dayjs().year();\n\n    const getFormattedDate = (date: any) => {\n      return window.dayjs(date).year(todayYear).format(\"YYYY-MM-DD\");\n    };\n\n    return [\n      m(\".user\", [\n        m(\".avatar\", avatar(user, { title: \"\" })),\n        m(\"\", [\n          m(\".username\", user.username()),\n          m(\".joinTime\", getFormattedDate(user.attribute(\"joinTime\"))),\n        ]),\n      ]),\n    ];\n  }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LoadingIndicator'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Placeholder'];","import AnniversariesState from \"../states/AnniversariesState\";\nimport AnniversariesListItem from \"./AnniversariesListItem\";\nimport Component, { ComponentAttrs } from \"flarum/common/Component\";\nimport Button from \"flarum/common/components/Button\";\nimport LoadingIndicator from \"flarum/common/components/LoadingIndicator\";\nimport Placeholder from \"flarum/common/components/Placeholder\";\nimport app from \"flarum/forum/app\";\n\ninterface Attrs extends ComponentAttrs {\n  state: AnniversariesState;\n}\n\n/**\n * Based on FriendsOfFlarum's UserDirectoryList\n */\n\nexport default class AnniversariesList extends Component<Attrs> {\n  view() {\n    const state = this.attrs.state;\n\n    let loading;\n\n    if (state.loading) {\n      loading = m(LoadingIndicator);\n    } else if (state.hasMoreResults()) {\n      loading = m(\n        Button,\n        {\n          class: \"Button\",\n          onclick: state.loadMore.bind(state),\n        },\n        app.translator.trans(\"nearata-cakeday.forum.page.load_more_button\")\n      );\n    }\n\n    if (state.isEmpty()) {\n      const text = app.translator.trans(\"nearata-cakeday.forum.page.empty\");\n      return [\n        m(\".AnniversariesList\", [\n          m(\"h2\", state.getH2()),\n          m(Placeholder, { text: text }),\n        ]),\n      ];\n    }\n\n    return [\n      m(\".AnniversariesList\", [\n        m(\"h2\", state.getH2()),\n        m(\"ul.AnniversariesList-users\", [\n          state.users.map((user) => {\n            return [\n              m(\n                \"li\",\n                {\n                  \"data-id\": user.id(),\n                },\n                m(AnniversariesListItem, { user: user })\n              ),\n            ];\n          }),\n        ]),\n        m(\".AnniversariesList-loadMore\", loading),\n      ]),\n    ];\n  }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Dropdown'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Page'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/helpers/listItems'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/ItemList'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/IndexPage'];","import AnniversariesState from \"../states/AnniversariesState\";\nimport AnniversariesList from \"./AnniversariesList\";\nimport Button from \"flarum/common/components/Button\";\nimport Dropdown from \"flarum/common/components/Dropdown\";\nimport Page from \"flarum/common/components/Page\";\nimport listItems from \"flarum/common/helpers/listItems\";\nimport ItemList from \"flarum/common/utils/ItemList\";\nimport app from \"flarum/forum/app\";\nimport IndexPage from \"flarum/forum/components/IndexPage\";\n\n/**\n * Based on FriendsOfFlarum's UserDirectoryPage\n */\n\nexport default class AnniversariesPage extends Page {\n  anniversariesState!: AnniversariesState;\n  filterOptions!: { [key: string]: any };\n  currentFilter!: string;\n\n  oninit(vnode: any) {\n    super.oninit(vnode);\n\n    this.anniversariesState = new AnniversariesState();\n    this.anniversariesState.refreshUsers();\n\n    this.filterOptions = this.anniversariesState.getFilterOptions();\n    this.currentFilter = this.anniversariesState.getCurrentFilter();\n  }\n\n  oncreate(vnode: any) {\n    super.oncreate(vnode);\n\n    // @ts-ignore\n    app.setTitle(app.translator.trans(\"nearata-cakeday.forum.page.title\"));\n    app.setTitleCount(0);\n  }\n\n  view() {\n    return [\n      m(\".IndexPage\", [\n        IndexPage.prototype.hero(),\n        m(\".container\", [\n          m(\".sideNavContainer\", [\n            m(\"nav.IndexPage-nav.sideNav\", [\n              m(\"ul\", listItems(this.sidebarItems().toArray())),\n            ]),\n            m(\".IndexPage-results.sideNavOffset\", [\n              m(\".IndexPage-toolbar\", [\n                m(\n                  \"ul.IndexPage-toolbar-view\",\n                  listItems(this.viewItems().toArray())\n                ),\n                m(\n                  \"ul.IndexPage-toolbar-action\",\n                  listItems(this.actionItems().toArray())\n                ),\n              ]),\n              m(AnniversariesList, {\n                state: this.anniversariesState,\n              }),\n            ]),\n          ]),\n        ]),\n      ]),\n    ];\n  }\n\n  sidebarItems() {\n    return IndexPage.prototype.sidebarItems();\n  }\n\n  viewItems(): ItemList<any> {\n    const items = new ItemList();\n\n    items.add(\n      \"sort\",\n      m(\n        Dropdown,\n        {\n          buttonClassName: \"Button\",\n          label: this.filterOptions[this.currentFilter],\n        },\n        Object.keys(this.filterOptions).map((value) => {\n          const label = this.filterOptions[value];\n          const active = this.currentFilter === value;\n\n          return m(\n            Button,\n            {\n              icon: active ? \"fas fa-check\" : true,\n              active: active,\n              onclick: () => {\n                this.changeFilter(value);\n              },\n            },\n            label\n          );\n        })\n      )\n    );\n\n    return items;\n  }\n\n  actionItems(): ItemList<any> {\n    const items = new ItemList();\n\n    items.add(\n      \"refresh\",\n      m(Button, {\n        title: app.translator.trans(\"core.forum.index.refresh_tooltip\"),\n        icon: \"fas fa-sync\",\n        class: \"Button Button--icon\",\n        onclick: () => {\n          this.anniversariesState.refreshUsers();\n        },\n      })\n    );\n\n    return items;\n  }\n\n  changeFilter(option: string) {\n    this.anniversariesState.changeFilter(option);\n    this.currentFilter = this.anniversariesState.getCurrentFilter();\n  }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Badge'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LinkButton'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/models/User'];","import AnniversariesPage from \"./components/AnniversariesPage\";\nimport Badge from \"flarum/common/components/Badge\";\nimport LinkButton from \"flarum/common/components/LinkButton\";\nimport { extend } from \"flarum/common/extend\";\nimport User from \"flarum/common/models/User\";\nimport app from \"flarum/forum/app\";\nimport IndexPage from \"flarum/forum/components/IndexPage\";\n\nconst memberDay = (today, joinTime) => {\n  const days = app.forum.attribute(\"cakedayNewMembersDays\");\n  const endDate = window.dayjs(joinTime).add(days, \"day\");\n\n  return today < endDate;\n};\n\napp.initializers.add(\"nearata-cakeday\", () => {\n  app.routes.nearata_cakeday_anniversaries = {\n    path: \"/anniversaries\",\n    resolver: {\n      onmatch: function (args) {\n        if (!app.forum.attribute(\"cakedayPageEnabled\")) {\n          return m.route.SKIP;\n        }\n\n        if (!app.session.user) {\n          return m.route.SKIP;\n        }\n\n        if (!app.session.user.attribute(\"canNearataCakedayViewPage\")) {\n          return m.route.SKIP;\n        }\n\n        return AnniversariesPage;\n      },\n    },\n  };\n\n  extend(IndexPage.prototype, \"navItems\", (items) => {\n    if (!app.forum.attribute(\"cakedayPageEnabled\")) {\n      return;\n    }\n\n    if (!app.session.user) {\n      return;\n    }\n\n    if (!app.session.user.attribute(\"canNearataCakedayViewPage\")) {\n      return;\n    }\n\n    items.add(\n      \"nearataCakedayAnniversaries\",\n      m(\n        LinkButton,\n        {\n          href: app.route(\"nearata_cakeday_anniversaries\"),\n          icon: \"fas fa-birthday-cake\",\n        },\n        app.translator.trans(\"nearata-cakeday.forum.page.title\")\n      )\n    );\n  });\n\n  extend(User.prototype, \"badges\", function (items) {\n    const joinTime = this.joinTime();\n\n    const join = window.dayjs(joinTime);\n    const today = window.dayjs();\n\n    let label = app.translator.trans(\"nearata-cakeday.forum.anniversary\");\n\n    const isMemberDay = app.forum.attribute(\"cakedayNewMembers\");\n    const isSameYear =\n      today.year() === join.year() && memberDay(today, joinTime);\n\n    if (isMemberDay && (isSameYear || memberDay(today, join))) {\n      if (app.forum.attribute(\"cakedayNewMembersLabel\")) {\n        label = app.translator.trans(\"nearata-cakeday.forum.new_member_label\");\n      }\n    } else {\n      const isMonth = join.month() === today.month();\n      const isDay = join.date() === today.date();\n\n      if (!(isMonth && isDay)) {\n        return;\n      }\n    }\n\n    const bgColor = app.forum.attribute(\"cakedayBgColor\");\n    const textColor = app.forum.attribute(\"cakedayTextColor\");\n\n    items.add(\n      \"nearataCakeday\",\n      m(Badge, {\n        type: \"cakeday\",\n        icon: \"fas fa-birthday-cake\",\n        label: label,\n        style: `background-color:${bgColor};color:${textColor}`,\n      })\n    );\n  });\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","_inheritsLoose","subClass","superClass","create","constructor","flarum","core","compat","trans","app","text1","dayjs","date","format","text2","dayjs1","dayjs2","date1","date2","AnniversariesState","users","loading","moreResults","currentFilter","this","loadUsers","find","getParams","then","push","payload","links","next","m","redraw","refreshUsers","clearUsers","hasMoreResults","isLoading","loadMore","params","offset","length","cakeday","getFilterOptions","today","tomorrow","upcoming","all","getCurrentFilter","changeFilter","option","isEmpty","getH2","window","add","text","upcomingTo","start","startOf","end","endOf","UserDirectoryListItem","user","view","attrs","todayYear","year","avatar","title","username","attribute","Component","AnniversariesList","state","LoadingIndicator","Button","class","onclick","Placeholder","map","id","AnniversariesListItem","AnniversariesPage","anniversariesState","filterOptions","oninit","vnode","oncreate","IndexPage","hero","listItems","sidebarItems","toArray","viewItems","actionItems","items","ItemList","Dropdown","buttonClassName","label","keys","active","icon","Page","memberDay","joinTime","days","nearata_cakeday_anniversaries","path","resolver","onmatch","args","route","SKIP","extend","LinkButton","href","User","join","isMemberDay","isSameYear","isMonth","month","isDay","bgColor","textColor","Badge","type","style"],"sourceRoot":""}