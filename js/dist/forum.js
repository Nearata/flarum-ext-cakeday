(()=>{var t={n:e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return t.d(r,{a:r}),r},d:(e,r)=>{for(var a in r)t.o(r,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:r[a]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";function r(t,e){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},r(t,e)}function a(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,r(t,e)}t.r(e);const n=flarum.core.compat["forum/app"];var o=t.n(n),s=function(t){return o().translator.trans("nearata-cakeday.forum.page.filter_options."+t)},i=function(t){var e=t.format("ll");return o().translator.trans("nearata-cakeday.forum.page.anniversaries_for_label",{date:e})},c=function(t,e){var r=t.format("ll"),a=e.format("ll");return o().translator.trans("nearata-cakeday.forum.page.anniversaries_between_label",{date1:r,date2:a})},u=function(){function t(){this.users=void 0,this.loading=void 0,this.moreResults=void 0,this.currentFilter=void 0,this.users=[],this.loading=!1,this.moreResults=!1,this.currentFilter="today"}var e=t.prototype;return e.loadUsers=function(){var t=this;o().store.find("users",this.getParams()).then((function(e){var r;(r=t.users).push.apply(r,e),t.moreResults=!!e.payload.links&&!!e.payload.links.next,t.loading=!1,m.redraw()}),(function(){t.loading=!1,m.redraw()}))},e.refreshUsers=function(){this.loading=!0,this.clearUsers(),this.loadUsers()},e.hasMoreResults=function(){return this.moreResults},e.clearUsers=function(){this.users=[],m.redraw()},e.isLoading=function(){return this.loading},e.loadMore=function(){this.loading=!0,this.loadUsers()},e.getParams=function(){var t={};return t.page={offset:this.users.length},t.sort="joinedAt",t.filter={cakeday:this.currentFilter},t},e.getFilterOptions=function(){return{today:s("today"),tomorrow:s("tomorrow"),upcoming:s("upcoming"),all:s("all")}},e.getCurrentFilter=function(){return this.currentFilter},e.changeFilter=function(t){this.currentFilter=t,this.refreshUsers()},e.isEmpty=function(){return 0===this.users.length&&!this.isLoading()},e.getH2=function(){var t=window.dayjs(),e=t.add(1,"day"),r=e.add(1,"day"),a="";switch(this.currentFilter){case"today":a=i(t);break;case"tomorrow":a=i(e);break;case"upcoming":var n=r.add(1,"week");a=c(r,n);break;case"all":var o=t.startOf("year"),s=t.endOf("year");a=c(o,s)}return a},t}();const l=flarum.core.compat["common/Component"];var d=t.n(l);const f=flarum.core.compat["common/helpers/avatar"];var p=t.n(f),y=function(t){function e(){for(var e,r=arguments.length,a=new Array(r),n=0;n<r;n++)a[n]=arguments[n];return(e=t.call.apply(t,[this].concat(a))||this).user=void 0,e}return a(e,t),e.prototype.view=function(){var t,e=this.attrs.user,r=window.dayjs().year();return[m(".user",[m(".avatar",p()(e,{title:""})),m("",[m(".username",e.username()),m(".joinTime",(t=e.attribute("joinTime"),window.dayjs(t).year(r).format("YYYY-MM-DD")))])])]},e}(d());const h=flarum.core.compat["common/components/Button"];var v=t.n(h);const g=flarum.core.compat["common/components/LoadingIndicator"];var b=t.n(g);const k=flarum.core.compat["common/components/Placeholder"];var w=t.n(k),P=function(t){function e(){return t.apply(this,arguments)||this}return a(e,t),e.prototype.view=function(){var t,e=this.attrs.state;if(e.loading?t=m(b()):e.hasMoreResults()&&(t=m(v(),{class:"Button",onclick:e.loadMore.bind(e)},o().translator.trans("nearata-cakeday.forum.page.load_more_button"))),e.isEmpty()){var r=o().translator.trans("nearata-cakeday.forum.page.empty");return[m(".AnniversariesList",[m("h2",e.getH2()),m(w(),{text:r})])]}return[m(".AnniversariesList",[m("h2",e.getH2()),m("ul.AnniversariesList-users",[e.users.map((function(t){return[m("li",{"data-id":t.id()},m(y,{user:t}))]}))]),m(".AnniversariesList-loadMore",t)])]},e}(d());const _=flarum.core.compat["common/components/Dropdown"];var O=t.n(_);const F=flarum.core.compat["common/components/Page"];var I=t.n(F);const j=flarum.core.compat["common/helpers/listItems"];var x=t.n(j);const S=flarum.core.compat["common/utils/ItemList"];var C=t.n(S);const M=flarum.core.compat["forum/components/IndexPage"];var A=t.n(M),L=function(t){function e(){for(var e,r=arguments.length,a=new Array(r),n=0;n<r;n++)a[n]=arguments[n];return(e=t.call.apply(t,[this].concat(a))||this).anniversariesState=void 0,e.filterOptions=void 0,e.currentFilter=void 0,e}a(e,t);var r=e.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e),this.anniversariesState=new u,this.anniversariesState.refreshUsers(),this.filterOptions=this.anniversariesState.getFilterOptions(),this.currentFilter=this.anniversariesState.getCurrentFilter()},r.oncreate=function(e){t.prototype.oncreate.call(this,e),o().setTitle(o().translator.trans("nearata-cakeday.forum.page.title")),o().setTitleCount(0)},r.view=function(){return[m(".IndexPage",[A().prototype.hero(),m(".container",[m(".sideNavContainer",[m("nav.IndexPage-nav.sideNav",[m("ul",x()(this.sidebarItems().toArray()))]),m(".IndexPage-results.sideNavOffset",[m(".IndexPage-toolbar",[m("ul.IndexPage-toolbar-view",x()(this.viewItems().toArray())),m("ul.IndexPage-toolbar-action",x()(this.actionItems().toArray()))]),m(P,{state:this.anniversariesState})])])])])]},r.sidebarItems=function(){return A().prototype.sidebarItems()},r.viewItems=function(){var t=this,e=new(C());return e.add("sort",m(O(),{buttonClassName:"Button",label:this.filterOptions[this.currentFilter]},Object.keys(this.filterOptions).map((function(e){var r=t.filterOptions[e],a=t.currentFilter===e;return m(v(),{icon:!a||"fas fa-check",active:a,onclick:function(){t.changeFilter(e)}},r)})))),e},r.actionItems=function(){var t=this,e=new(C());return e.add("refresh",m(v(),{title:o().translator.trans("core.forum.index.refresh_tooltip"),icon:"fas fa-sync",class:"Button Button--icon",onclick:function(){t.anniversariesState.refreshUsers()}})),e},r.changeFilter=function(t){this.anniversariesState.changeFilter(t),this.currentFilter=this.anniversariesState.getCurrentFilter()},e}(I());const U=flarum.core.compat["common/components/Badge"];var N=t.n(U);const B=flarum.core.compat["common/components/LinkButton"];var T=t.n(B);const R=flarum.core.compat["common/extend"],D=flarum.core.compat["common/models/User"];var E=t.n(D),Y=function(t,e){var r=o().forum.attribute("cakedayNewMembersDays");return t<window.dayjs(e).add(r,"day")};o().initializers.add("nearata-cakeday",(function(){o().routes.nearata_cakeday_anniversaries={path:"/anniversaries",resolver:{onmatch:function(t){return o().forum.attribute("cakedayPageEnabled")&&o().session.user&&o().session.user.attribute("canNearataCakedayViewPage")?L:m.route.SKIP}}},(0,R.extend)(A().prototype,"navItems",(function(t){o().forum.attribute("cakedayPageEnabled")&&o().session.user&&o().session.user.attribute("canNearataCakedayViewPage")&&t.add("nearataCakedayAnniversaries",m(T(),{href:o().route("nearata_cakeday_anniversaries"),icon:"fas fa-birthday-cake"},o().translator.trans("nearata-cakeday.forum.page.title")))})),(0,R.extend)(E().prototype,"badges",(function(t){var e=this.joinTime(),r=window.dayjs(e),a=window.dayjs(),n=o().translator.trans("nearata-cakeday.forum.anniversary"),s=o().forum.attribute("cakedayNewMembers"),i=a.year()===r.year()&&Y(a,e);if(s&&(i||Y(a,r)))o().forum.attribute("cakedayNewMembersLabel")&&(n=o().translator.trans("nearata-cakeday.forum.new_member_label"));else{var c=r.month()===a.month(),u=r.date()===a.date();if(!c||!u)return}var l=o().forum.attribute("cakedayBgColor"),d=o().forum.attribute("cakedayTextColor");t.add("nearataCakeday",m(N(),{type:"cakeday",icon:"fas fa-birthday-cake",label:n,style:"background-color:"+l+";color:"+d}))}))}))})(),module.exports=e})();
//# sourceMappingURL=forum.js.map