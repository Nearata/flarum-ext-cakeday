(()=>{var t={n:e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return t.d(r,{a:r}),r},d:(e,r)=>{for(var a in r)t.o(r,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:r[a]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";function r(t,e){return r=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},r(t,e)}function a(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,r(t,e)}t.r(e);var n=function(t){return app.translator.trans("nearata-cakeday.forum.page.filter_options."+t)},o=function(t){var e=t.format("ll");return app.translator.trans("nearata-cakeday.forum.page.anniversaries_for_label",{date:e})},s=function(t,e){var r=t.format("ll"),a=e.format("ll");return app.translator.trans("nearata-cakeday.forum.page.anniversaries_between_label",{date1:r,date2:a})},i=function(){function t(){this.users=[],this.loading=!1,this.moreResults=!1,this.currentFilter="today"}var e=t.prototype;return e.loadUsers=function(){var t=this;app.store.find("users",this.getParams()).then((function(e){var r;(r=t.users).push.apply(r,e),t.moreResults=!!e.payload.links&&!!e.payload.links.next,t.loading=!1,m.redraw()}),(function(){t.loading=!1,m.redraw()}))},e.refreshUsers=function(){this.loading=!0,this.clearUsers(),this.loadUsers()},e.hasMoreResults=function(){return this.moreResults},e.clearUsers=function(){this.users=[],m.redraw()},e.isLoading=function(){return this.loading},e.loadMore=function(){this.loading=!0,this.loadUsers()},e.getParams=function(){var t={};return t.page={offset:this.users.length},t.sort="joinedAt",t.filter={cakeday:this.currentFilter},t},e.getFilterOptions=function(){return{today:n("today"),tomorrow:n("tomorrow"),upcoming:n("upcoming"),all:n("all")}},e.getCurrentFilter=function(){return this.currentFilter},e.changeFilter=function(t){this.currentFilter=t,this.refreshUsers()},e.isEmpty=function(){return 0===this.users.length&&!this.isLoading()},e.getH2=function(){var t=window.dayjs(),e=t.add(1,"day"),r=e.add(1,"day"),a="";switch(this.currentFilter){case"today":a=o(t);break;case"tomorrow":a=o(e);break;case"upcoming":var n=r.add(1,"week");a=s(r,n);break;case"all":var i=t.startOf("year"),c=t.endOf("year");a=s(i,c)}return a},t}();const c=flarum.core.compat["common/Component"];var u=t.n(c);const l=flarum.core.compat["common/helpers/avatar"];var d=t.n(l),f=function(t){function e(){return t.apply(this,arguments)||this}return a(e,t),e.prototype.view=function(){var t,e=this.attrs.user,r=window.dayjs().year();return[m(".user",[m(".avatar",d()(e,{title:""})),m("",[m(".username",e.username()),m(".joinTime",(t=e.attribute("joinTime"),window.dayjs(t).year(r).format("YYYY-MM-DD")))])])]},e}(u());const p=flarum.core.compat["common/components/Button"];var y=t.n(p);const h=flarum.core.compat["common/components/LoadingIndicator"];var v=t.n(h);const g=flarum.core.compat["common/components/Placeholder"];var b=t.n(g),k=function(t){function e(){return t.apply(this,arguments)||this}return a(e,t),e.prototype.view=function(){var t,e=this.attrs.state;if(e.isLoading()?t=m(v()):e.hasMoreResults()&&(t=m(y(),{class:"Button",onclick:e.loadMore.bind(e)},app.translator.trans("nearata-cakeday.forum.page.load_more_button"))),e.isEmpty()){var r=app.translator.trans("nearata-cakeday.forum.page.empty");return[m(".AnniversariesList",[m("h2",e.getH2()),m(b(),{text:r})])]}return[m(".AnniversariesList",[m("h2",e.getH2()),m("ul.AnniversariesList-users",[e.users.map((function(t){return[m("li",{"data-id":t.id()},m(f,{user:t}))]}))]),m(".AnniversariesList-loadMore",t)])]},e}(u());const w=flarum.core.compat["common/components/Dropdown"];var P=t.n(w);const _=flarum.core.compat["common/components/IndexPage"];var O=t.n(_);const I=flarum.core.compat["common/helpers/listItems"];var j=t.n(I);const F=flarum.core.compat["common/utils/ItemList"];var x=t.n(F);const M=flarum.core.compat["forum/components/Page"];var C=function(t){function e(){return t.apply(this,arguments)||this}a(e,t);var r=e.prototype;return r.oninit=function(e){t.prototype.oninit.call(this,e),this.state=new i,this.state.refreshUsers(),this.filterOptions=this.state.getFilterOptions(),this.currentFilter=this.state.getCurrentFilter()},r.view=function(){return[m(".IndexPage",[O().prototype.hero(),m(".container",[m(".sideNavContainer",[m("nav.IndexPage-nav.sideNav",[m("ul",j()(this.sidebarItems().toArray()))]),m(".IndexPage-results.sideNavOffset",[m(".IndexPage-toolbar",[m("ul.IndexPage-toolbar-view",j()(this.viewItems().toArray())),m("ul.IndexPage-toolbar-action",j()(this.actionItems().toArray()))]),m(k,{state:this.state})])])])])]},r.sidebarItems=function(){return O().prototype.sidebarItems()},r.viewItems=function(){var t=this,e=new(x());return e.add("sort",m(P(),{buttonClassName:"Button",label:this.filterOptions[this.currentFilter]},Object.keys(this.filterOptions).map((function(e){var r=t.filterOptions[e],a=t.currentFilter===e;return m(y(),{icon:!a||"fas fa-check",active:a,onclick:function(){t.changeFilter(e)}},r)})))),e},r.actionItems=function(){var t=this,e=new(x());return e.add("refresh",m(y(),{title:app.translator.trans("core.forum.index.refresh_tooltip"),icon:"fas fa-sync",class:"Button Button--icon",onclick:function(){t.state.refreshUsers()}})),e},r.changeFilter=function(t){this.state.changeFilter(t),this.currentFilter=this.state.getCurrentFilter()},e}(t.n(M)());const L=flarum.core.compat["common/components/Badge"];var U=t.n(L);const A=flarum.core.compat["common/components/LinkButton"];var N=t.n(A);const B=flarum.core.compat["common/extend"],S=flarum.core.compat["common/models/User"];var T=t.n(S);const R=flarum.core.compat["forum/app"];var D=t.n(R),E=function(t,e){var r=D().forum.attribute("cakedayNewMembersDays");return t<window.dayjs(e).add(r,"day")};D().initializers.add("nearata-cakeday",(function(){D().routes.nearata_cakeday_anniversaries={path:"/anniversaries",resolver:{onmatch:function(t){return D().forum.attribute("cakedayPageEnabled")&&D().session.user&&D().session.user.attribute("canNearataCakedayViewPage")?C:m.route.SKIP}}},(0,B.extend)(O().prototype,"navItems",(function(t){D().forum.attribute("cakedayPageEnabled")&&D().session.user&&D().session.user.attribute("canNearataCakedayViewPage")&&t.add("nearataCakedayAnniversaries",m(N(),{href:D().route("nearata_cakeday_anniversaries"),icon:"fas fa-birthday-cake"},D().translator.trans("nearata-cakeday.forum.page.title")))})),(0,B.extend)(T().prototype,"badges",(function(t){var e=this.joinTime(),r=window.dayjs(e),a=window.dayjs(),n=D().translator.trans("nearata-cakeday.forum.anniversary"),o=D().forum.attribute("cakedayNewMembers"),s=a.year()===r.year()&&E(a,e);if(o&&(s||E(a,r)))D().forum.attribute("cakedayNewMembersLabel")&&(n=D().translator.trans("nearata-cakeday.forum.new_member_label"));else{var i=r.month()===a.month(),c=r.date()===a.date();if(!i||!c)return}var u=D().forum.attribute("cakedayBgColor"),l=D().forum.attribute("cakedayTextColor");t.add("nearataCakeday",m(U(),{type:"cakeday",icon:"fas fa-birthday-cake",label:n,style:"background-color:"+u+";color:"+l}))}))}))})(),module.exports=e})();
//# sourceMappingURL=forum.js.map